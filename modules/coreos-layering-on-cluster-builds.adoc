// Module included in the following assemblies:
//
// * post-installation_configuration/coreos-layering.adoc

:_content-type: CONCEPT
[id="coreos-layering-on-cluster-builds_{context}"]
= On-cluster builds

In some situations, you might want to build any available version of {op-system} that are newer than the one currently in use by a MachineConfigPool. On-cluster builds let you build an image directly on a {product-title} cluster, rather than outside the cluster, and applies those image updates to MachineConfigs while the cluster is still in use.

:FeatureName: On-cluster builds for image layering
include::snippets/technology-preview.adoc[leveloffset=+1]

On-cluster builds are possible using several subcomponents that work together. These subcomponents are:

* The BuildController
** This component listens for changes in a specified MachineConfigPool and fetches the rendered MachineConfig to begin the build process. This component signals to either the ImageBuildController or the PodBuildController to start building a new image.

* The ImageBuildController
** This component is responsible for building the new image using the OpenShift Image Builder functionality. The BuildController will choose this mechanism to build the image if the feature is present on an {product-title} cluster.

* The PodBuildController
** This component is responsible for building the new image using a custom build pod of the officially published Buildah image. In order to map the build UID within the Buildah container to a UID on the cluster, the PodBuildController runs with the fewest privileges possible. The final image is passed back to the BuildController using a secondary container that creates a ConfigMap using the Buildah digestfile contents. The BuildController will pass back the ConfigMap and the PodBuildController contructs a fully-qualified image pullspec.
